# 智能画布 - 思源笔记插件

将类似 Cursor 和 GPT Canvas 的交互式 AI 助手体验带入您的思源笔记工作空间。与 AI 对话，提供笔记上下文，让 AI 帮助您更智能地编写和处理文档。

## 主要功能

*   **集成聊天界面：** 在思源笔记中提供一个专门的面板，用于和 AI 进行交互。
*   **上下文感知：**
    *   自动识别当前活动文档。
    *   允许引用特定的块或整个文档作为 AI 的上下文。
*   **上下文引用：**
    *   **块选区引用：** 在编辑器中选中块内文本，点击聊天面板的"引用选区"按钮，将包含选中文本的块添加为上下文引用（例如标签"选区 1"）。此引用仅对当前发送的消息有效。
    *   **文档引用：** 点击引用栏上的"@"按钮，将当前打开的文档添加为持久化的上下文引用。
    *   **引用栏：** 清晰地显示当前激活的上下文引用标签，并允许移除它们。
*   **AI 交互：**
    *   与可配置的 AI 模型（如 DeepSeek、GPT 等）进行对话。
    *   AI 会使用您提供的文档和块引用作为上下文来生成回复。
    *   (未来功能) 根据 AI 的建议执行插入、删除、修改笔记内容等命令。
*   **对话管理：**
    *   自动保存对话。
    *   从历史记录列表中加载之前的对话。
    *   可以删除不需要的对话记录。
*   **插件设置：** 配置您的 AI 服务 API Key，并选择要使用的 AI 模型。

## 如何使用

### 安装

1.  从最新的 [GitHub Release](https://github.com/B3000Kcn/siyuan-plugin-canvas/releases) 下载 `package.zip` 文件 (请替换为您的实际链接)。
2.  在思源笔记中，打开 `设置` -> `集市` -> `手动安装插件`。
3.  选择下载的 `package.zip` 文件。
4.  在 `已下载` 标签页中启用"智能画布"插件。

### 设置

1.  启用插件后，应该会出现一个新的图标（或者通过插件设置/面板访问）。
2.  打开插件面板。
3.  进入插件设置（通常在思源主菜单 `设置` -> `插件` 下找到）。
4.  输入您的 AI 服务 API Key，选择您想使用的 AI 模型，并保存设置。

### 基本用法

1.  **打开面板：** 访问智能画布聊天面板。
2.  **提供上下文 (可选)：**
    *   **引用块：** 在笔记编辑器中选中一个或多个块内的文本，然后点击聊天面板中的"引用选区"按钮。引用栏中会出现类似"选区 1"的标签。
    *   **引用文档：** 浏览文档时，点击引用栏上的"@"按钮，将整个文档添加为上下文。引用栏中会出现带有文档名称的标签。
    *   **移除引用：** 点击引用标签上的"×"即可移除该引用。
3.  **聊天：** 在输入框中输入您的问题或指令，按回车或点击"发送"按钮。AI 将结合当前激活的引用上下文进行回复。
4.  **管理历史：** 使用"📜 加载历史对话"按钮查看、加载或删除过去的对话。
5.  **新对话：** 点击"➕ 新对话"按钮开始一个全新的对话。

**## 注意事项**

*   **关于"引用选区"：** 当您选中编辑器中的文本（即使跨越多个块）并点击"引用选区"时，插件会将**包含这些选中文本的所有块的完整内容**作为上下文提供给 AI，而不是仅仅提供您选中的那部分文字。AI 会知道这些块都属于同一个引用标签（如"选区 1"）。
*   **多块引用的限制：** 当一个引用标签（如"选区 1"）关联了多个块时：
    *   AI 可以**读取并理解**所有关联块的内容，并综合这些信息来回答您的问题。
    *   但请注意，AI **无法同时对多个块执行操作**（如修改或插入）。如果您需要 AI 执行具体操作，请确保每次只引用单个块，或在指令中明确指定要操作的特定块。

## 开发说明

本插件使用 Vite 和 Svelte 构建。

1.  克隆本仓库。
2.  安装依赖：`pnpm install`
3.  运行开发服务器：`pnpm run dev` (需要先使用 `pnpm run make-link` 或 `pnpm run make-link-win` 创建开发链接)。
4.  构建生产版本：`pnpm run build`

## 许可证

本插件使用 Apache License 2.0 许可证。

## 作者

B3000Kcn

